-- الانتظار حتى يتم تحميل اللعبة بالكامل
repeat task.wait() until game:IsLoaded()

-- الخدمات الأساسية
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- الانتظار حتى يتم تحميل PlayerGui
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui", 10) -- مهلة 10 ثوانٍ
if not PlayerGui then
    warn("فشل تحميل PlayerGui")
    return
end

-- البحث عن الكائنات المطلوبة مع التحقق من وجودها
local success, cuffPart = pcall(function()
    return Workspace:WaitForChild("streets"):WaitForChild("Part")
end)
if not success or not cuffPart then
    warn("لم يتم العثور على cuffPart في Workspace.streets.Part")
    return
end

local success, remote = pcall(function()
    return ReplicatedStorage:WaitForChild("ChatRe"):WaitForChild("r3"):WaitForChild("Re"):WaitForChild("aqhrwilfaxguity")
end)
if not success or not remote then
    warn("لم يتم العثور على الريموت في المسار المحدد")
    -- طباعة جميع الريموتات للتحقق (اختياري)
    for _, obj in pairs(ReplicatedStorage:GetDescendants()) do
        if obj:IsA("RemoteEvent") then
            print("ريموت موجود: " .. obj:GetFullName())
        end
    end
    return
end

-- إنشاء واجهة المستخدم الرسومية (ScreenGui)
local gui = Instance.new("ScreenGui")
gui.Name = "CuffGui"
gui.ResetOnSpawn = false
gui.Enabled = true -- التأكد من تفعيل الواجهة
gui.Parent = PlayerGui
print("تم إنشاء الـ GUI بنجاح")

-- إنشاء الإطار (Frame)
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 100)
frame.Position = UDim2.new(0.5, -100, 0.5, -50)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = gui

-- إنشاء زر الكلبشة (TextButton)
local button = Instance.new("TextButton")
button.Size = UDim2.new(1, -10, 1, -10) -- تصغير الزر قليلاً ليبدو أنيقًا
button.Position = UDim2.new(0, 5, 0, 5) -- توسيط الزر داخل الإطار
button.Text = "Cuff All"
button.TextColor3 = Color3.new(1, 1, 1)
button.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
button.Font = Enum.Font.SourceSansBold
button.TextSize = 24
button.Parent = frame

-- متغير لتتبع حالة الكلبشة
local running = false

-- وظيفة تفعيل/إيقاف الكلبشة
button.MouseButton1Click:Connect(function()
    running = not running
    button.Text = running and "Stop Cuff" or "Cuff All"

    if running then
        task.spawn(function()
            while running do
                for _, player in pairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        local args = {
                            [1] = "Cuff",
                            [2] = cuffPart
                        }
                        local success, err = pcall(function()
                            remote:FireServer(unpack(args))
                        end)
                        if not success then
                            warn("فشل إطلاق الريموت: " .. tostring(err))
                        end
                    end
                end
                task.wait(0.1) -- تأخير صغير لتجنب الحمل الزائد
            end
        end)
    end
end)
